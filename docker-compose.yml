services:
  smb-reshare:
    image: ghcr.io/gideonbear/smb-reshare@sha256:ea88c9ea6d20d17219b8632626c6e80b2e9d83662d93b2906e2a064c07e625be
    container_name: smb-reshare
    environment:
      OLD_DOMAIN: NAS
      OLD_HOST: 192.168.1.100
      OLD_DIRECTORY: directory
      OLD_USERNAME_FILE: /run/secrets/old_username  # Or OLD_USERNAME
      OLD_PASSWORD_FILE: /run/secrets/old_password  # Or OLD_PASSWORD
      NEW_USERNAME_FILE: /run/secrets/new_username  # Or NEW_USERNAME
      NEW_PASSWORD_FILE: /run/secrets/new_password  # Or NEW_PASSWORD
    ports:
      # SMB port. 139 is legacy (NetBIOS) and not needed.
      - "445:445"
    cap_add:
      # For mounting
      - SYS_ADMIN
      # For CIFS mounting
      - DAC_READ_SEARCH
    security_opt:
      # Also for mounting?
      - apparmor:unconfined
    restart: unless-stopped
    secrets:
      - old_username
      - old_password
      - new_username
      - new_password

secrets:
  old_username:
    file: ./old_username.txt
  old_password:
    file: ./old_password.txt
  new_username:
    file: ./new_username.txt
  new_password:
    file: ./new_password.txt
